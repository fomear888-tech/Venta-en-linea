<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ‚úÖ T√çTULO DE LA PESTA√ëA DEL NAVEGADOR -->
  <title>Cat√°logo ¬∑ Carrito</title>
  
  <style>

/* ‚úÖ ESTILOS GENERALES (COLORES Y ‚ÄúTEMA‚Äù DE LA WEB) Aqu√≠ defines los colores base y el look (fondo, textos, bordes, botones). */
    
    :root{--bg:#0b1220;--card:#101b33;--muted:#8ea0c6;--txt:#eaf0ff;--accent:#5eead4;--danger:#ff6b6b;--border:rgba(255,255,255,.10)}

    /* ‚úÖ REGLAS B√ÅSICAS PARA QUE TODO SE VEA ORDENADO */
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial; background:linear-gradient(180deg,#070b14, var(--bg)); color:var(--txt)}

    /* ‚úÖ CABECERA FIJA (BUSCADOR, ICONO DEL CARRITO, BOT√ìN VACIAR) */
    header{position:sticky;top:0;z-index:10;background:rgba(7,11,20,.85);backdrop-filter:blur(10px);border-bottom:1px solid var(--border)}

    /* ‚úÖ CONTENEDOR ‚ÄúCENTRADO‚Äù (ANCHO M√ÅXIMO) */
    .wrap{max-width:1100px;margin:0 auto;padding:18px 16px}

    /* ‚úÖ ESTRUCTURA DE LA PARTE SUPERIOR */
    .top{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:40px;height:40px;border-radius:14px;background:radial-gradient(circle at 30% 20%, var(--accent), transparent 55%), linear-gradient(135deg,#2b2f55,#111a33); border:1px solid var(--border)}
    h1{font-size:18px;margin:0;letter-spacing:.3px}
    .sub{color:var(--muted);font-size:12px;margin-top:2px}

    /* ‚úÖ BUSCADOR, ‚ÄúP√çLDORAS‚Äù Y BOTONES DE LA CABECERA */
    .actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .search{display:flex;align-items:center;gap:10px;padding:10px 12px;border:1px solid var(--border);border-radius:14px;background:rgba(255,255,255,.03);min-width:min(420px, 92vw)}
    .search input{width:100%;border:0;outline:0;background:transparent;color:var(--txt);font-size:14px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:14px;border:1px solid var(--border);background:rgba(255,255,255,.03);color:var(--txt);cursor:pointer;user-select:none}
    .pill strong{font-weight:700}
    .pill:hover{border-color:rgba(94,234,212,.35)}

    /* ‚úÖ LAYOUT PRINCIPAL: CATALOGO A LA IZQ / CARRITO A LA DER (EN M√ìVIL SE APILAN) */
    main .grid{display:grid;grid-template-columns:1.25fr .85fr;gap:16px;align-items:start}
    @media (max-width: 920px){main .grid{grid-template-columns:1fr}}

    /* ‚úÖ ‚ÄúCAJAS‚Äù TIPO PANEL PARA CATALOGO Y CARRITO */
    .panel{border:1px solid var(--border);border-radius:18px;background:rgba(255,255,255,.03);overflow:hidden}
    .panel h2{margin:0;padding:14px 14px;border-bottom:1px solid var(--border);font-size:14px;letter-spacing:.25px}
    .panel .content{padding:14px}

    /* ‚úÖ GRID DE PRODUCTOS (3 columnas / 2 / 1 seg√∫n pantalla) */
    .products{display:grid;grid-template-columns:repeat(3, minmax(0,1fr));gap:12px}
    @media (max-width: 920px){.products{grid-template-columns:repeat(2, minmax(0,1fr))}}
    @media (max-width: 520px){.products{grid-template-columns:1fr}}


    /* ‚úÖ TARJETAS DE PRODUCTO + BOTONES */
    .card{border:1px solid var(--border);border-radius:16px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02))}
    .tag{display:inline-flex;align-items:center;font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);color:var(--muted)}
    .title{margin:10px 0 6px;font-size:14px;font-weight:700}
    .desc{margin:0 0 12px;color:var(--muted);font-size:12px;line-height:1.35}
    .row{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .price{font-weight:800}
    .btn{border:1px solid rgba(94,234,212,.35);background:rgba(94,234,212,.10);color:var(--txt);padding:9px 10px;border-radius:12px;cursor:pointer;font-weight:700}
    .btn:hover{background:rgba(94,234,212,.16)}
    .btn:active{transform:translateY(1px)}
    .btn.secondary{border-color:var(--border);background:rgba(255,255,255,.03)}
    .btn.danger{border-color:rgba(255,107,107,.35);background:rgba(255,107,107,.10)}

  
/* ‚úÖ IM√ÅGENES DE PRODUCTO */
.pimg{
  width:100%;
  aspect-ratio: 4 / 3;
  border-radius:14px;
  border:1px solid var(--border);
  background:rgba(255,255,255,.03);
  overflow:hidden;
  margin-bottom:10px;
}
.pimg img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

    
    
    /* ‚úÖ CARRITO: LISTA DE ITEMS Y CONTROLES DE CANTIDAD */
    .cartList{display:flex;flex-direction:column;gap:10px}
    .cartItem{border:1px solid var(--border);border-radius:16px;padding:12px;background:rgba(255,255,255,.03)}
    .cartItem .name{font-weight:800;font-size:13px;margin:0 0 6px}
    .meta{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .muted{color:var(--muted);font-size:12px}

    .qty{display:inline-flex;align-items:center;gap:8px}
    .qty button{width:34px;height:34px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.03);color:var(--txt);cursor:pointer;font-size:16px}
    .qty button:hover{border-color:rgba(94,234,212,.35)}
    .qty input{width:58px;text-align:center;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.03);color:var(--txt);padding:8px 10px;outline:0}


    /* ‚úÖ TOTALES (SUBTOTAL / TOTAL) */
    .totals{border-top:1px solid var(--border);margin-top:12px;padding-top:12px}
    .totals .line{display:flex;justify-content:space-between;align-items:center;margin:6px 0}
    .totals .grand{font-size:16px;font-weight:900}


    /* ‚úÖ PIE DE P√ÅGINA */
    .empty{color:var(--muted);font-size:13px;line-height:1.45;margin:0}
    footer{color:var(--muted);font-size:12px;text-align:center;padding:18px 16px}
    code{background:rgba(255,255,255,.06);padding:2px 6px;border-radius:8px}

  
/* Para el carrito */
#cartPanel {
  scroll-margin-top: 90px;
}
    
  </style>
</head>
<body>

  
  <!-- ‚úÖ CABECERA: Marca + buscador + contador de carrito + vaciar -->
<header>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Cat√°logo ¬∑ Carrito</h1>
          <div class="sub">Elige productos, ajusta cantidades y revisa el total.</div>
        </div>
      </div>
      <div class="actions">
        <div class="search" role="search">
          <span aria-hidden="true">üîé</span>
          <input id="q" type="search" placeholder="Buscar productos‚Ä¶" autocomplete="off" />
        </div>
        <div class="pill" id="cartCount" title="Productos en el carrito">üõí <strong>0</strong></div>
        <button class="pill" id="resetBtn" title="Vaciar carrito">üßπ Vaciar</button>
      </div>
    </div>
  </div>
</header>


  <!-- ‚úÖ CUERPO: 2 PANELES: CATALOGO (izq) + CARRITO (der) -->
<main>
  <div class="wrap">
    <div class="grid">


      <!-- ‚úÖ PANEL CATALOGO: aqu√≠ se ‚Äúpintan‚Äù las tarjetas de producto (JS rellena #products) -->
      <section class="panel" aria-label="Cat√°logo">
        <h2>Cat√°logo</h2>
        <div class="content">
          <div id="products" class="products"></div>
        </div>
      </section>


      <!-- ‚úÖ PANEL CARRITO: JS rellena #cart y calcula totales -->
      <aside class="panel" aria-label="Carrito" id="cartPanel">
        <h2>Carrito</h2>
        <div class="content">
          <div id="cart" class="cartList"></div>

          <div class="totals">
            <div class="line"><span class="muted">Productos</span><span id="itemsCount" class="muted">0</span></div>
            <div class="line"><span class="muted">Subtotal</span><span id="subtotal" class="muted">0,00 ‚Ç¨</span></div>
            <div class="line grand"><span>Total</span><span id="total">0,00 ‚Ç¨</span></div>

              <!-- ‚úÖ DATOS DEL CLIENTE: se env√≠an junto al pedido -->
            <div style="display:grid; gap:10px; margin:12px 0;">
              <input id="customerName" placeholder="Nombre y apellidos" style="padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.03);color:#eaf0ff;outline:0;">
              <input id="customerPhone" placeholder="Tel√©fono" style="padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.03);color:#eaf0ff;outline:0;">
            </div>


   <!-- ‚úÖ BOTONES:
                   - Copiar resumen: √∫til para pegar en WhatsApp
                   - Exportar CSV: descargar archivo para Excel (manual)
                   - Confirmar pedido: env√≠a a Google Sheets (autom√°tico) -->
            
            <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn" id="submitOrder">Confirmar pedido</button>
            </div>

            <p class="muted" style="margin:10px 0 0">Asegurese de ingresar los datos correctamente</p>
          </div>
        </div>
      </aside>

    </div>
  </div>
</main>


  <!-- ‚úÖ PIE -->

<footer>
<code>index.html</code>
</footer>

<script>
  // ====== CONFIG: pon aqu√≠ tus productos ======
  // Cambia nombres, precios y categor√≠as. Puedes a√±adir tantos como quieras.
  const PRODUCTS = [
  { id: 'p1', name: 'Funda m√≥vil (silicona)', category: 'Accesorios', price: 6.50, desc: 'Protecci√≥n b√°sica y ligera.', img: 'img/placeholder.png' },
  { id: 'p2', name: 'Cable USB-C r√°pido', category: 'Accesorios', price: 7.90, desc: 'Carga y datos de alta velocidad.', img: 'img/placeholder.png' },
  { id: 'p3', name: 'Cargador 20W', category: 'Accesorios', price: 12.90, desc: 'Compatible con la mayor√≠a de m√≥viles.', img: 'img/placeholder.png' },
  { id: 'p4', name: 'Impresi√≥n B/N (10 p√°ginas)', category: 'Servicios', price: 2.00, desc: 'Pack de impresi√≥n blanco y negro.', img: 'img/placeholder.png' },
  { id: 'p5', name: 'Impresi√≥n color (5 p√°ginas)', category: 'Servicios', price: 3.50, desc: 'Pack de impresi√≥n a color.', img: 'img/placeholder.png' },
  { id: 'p6', name: 'Plastificado A4', category: 'Servicios', price: 2.50, desc: 'Protege documentos con acabado brillante.', img: 'img/placeholder.png' },
];

  // ‚úÖ (2) REFERENCIAS A ELEMENTOS HTML Y ESTADO:
  // Aqu√≠ ‚Äúcapturamos‚Äù elementos del DOM para poder actualizar la pantalla con JS.
  
  const $ = (s) => document.querySelector(s);
  const productsEl = $('#products');
  const cartEl = $('#cart');
  const qEl = $('#q');

  const cartCountEl = $('#cartCount strong');
  const itemsCountEl = $('#itemsCount');
  const subtotalEl = $('#subtotal');
  const totalEl = $('#total');


    // ‚úÖ (3) GUARDADO LOCAL DEL CARRITO:
    // Este nombre es la ‚Äúclave‚Äù en localStorage para recordar el carrito aunque cierre la web.
  
  const STORAGE_KEY = 'cart_v1';

    // ‚úÖ (4) CARRITO EN MEMORIA (OBJETO):
    // cart guarda { productId: {id, qty} }. Se carga desde localStorage al entrar.
  
  /** cart: { [productId]: {id, qty} } */
  let cart = loadCart();

    // ‚úÖ (5) FORMATO DE MONEDA:
    // Convierte n√∫meros a ‚Äú0,00 ‚Ç¨‚Äù en espa√±ol.
  
  const eur = (n) => new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR' }).format(n);

  
    // ‚úÖ (6) FUNCIONES DE LOCALSTORAGE:
    // - loadCart: leer carrito guardado
    // - saveCart: guardar carrito actualizado
  
  function loadCart(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return {};
      const parsed = JSON.parse(raw);
      return parsed && typeof parsed === 'object' ? parsed : {};
    } catch { return {}; }
  }

  function saveCart(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(cart));
  }


    // ‚úÖ (7) BUSCAR PRODUCTOS Y CALCULAR TOTALES

  function getProduct(id){
    return PRODUCTS.find(p => p.id === id);
  }

  function cartItems(){
    return Object.values(cart)
      .map(ci => ({...ci, product: getProduct(ci.id)}))
      .filter(x => x.product);
  }

  function countsAndTotals(){
    const items = cartItems();
    const distinct = items.length;
    const units = items.reduce((a, x) => a + x.qty, 0);
    const subtotal = items.reduce((a, x) => a + x.qty * x.product.price, 0);
    return { distinct, units, subtotal, total: subtotal };
  }

    // ‚úÖ (8) RENDER DEL CAT√ÅLOGO:
    // Crea las tarjetas seg√∫n PRODUCTS y el texto buscado.

  function renderProducts(){
    const q = qEl.value.trim().toLowerCase();
    const list = PRODUCTS.filter(p => {
      if(!q) return true;
      return (p.name + ' ' + p.category + ' ' + (p.desc||'')).toLowerCase().includes(q);
    });

    productsEl.innerHTML = '';
    list.forEach(p => {
      const el = document.createElement('div');
      el.className = 'card';

      
      el.innerHTML = `
  <div class="pimg">
    <img src="${escapeHtml(p.img || 'img/placeholder.png')}" alt="${escapeHtml(p.name)}" loading="lazy">
  </div>
  <div class="tag">${escapeHtml(p.category)}</div>
  <div class="title">${escapeHtml(p.name)}</div>
  <p class="desc">${escapeHtml(p.desc||'')}</p>
  <div class="row">
    <div class="price">${eur(p.price)}</div>
    <button class="btn" data-add="${p.id}">A√±adir</button>
  </div>
`;

      
      productsEl.appendChild(el);
    });

      // Botones ‚ÄúA√±adir‚Äù: suman al carrito
    productsEl.querySelectorAll('[data-add]').forEach(btn => {
      btn.addEventListener('click', () => addToCart(btn.getAttribute('data-add')));
    });
  }


    // ‚úÖ (9) RENDER DEL CARRITO:
    // Dibuja los productos a√±adidos + controles de cantidad + bot√≥n quitar.
  
  function renderCart(){
    const items = cartItems();
    cartEl.innerHTML = '';

    if(items.length === 0){
      cartEl.innerHTML = `
        <p class="empty">Tu carrito est√° vac√≠o. A√±ade productos del cat√°logo y ver√°s aqu√≠ el detalle con cantidades y total.</p>
      `;
      updateTotals();
      return;
    }

    items.forEach(({id, qty, product}) => {
      const lineTotal = qty * product.price;
      const el = document.createElement('div');
      el.className = 'cartItem';
      el.innerHTML = `
        <div class="name">${escapeHtml(product.name)}</div>
        <div class="meta">
          <div class="muted">${escapeHtml(product.category)} ¬∑ ${eur(product.price)} c/u</div>
          <div class="muted"><strong>${eur(lineTotal)}</strong></div>
        </div>
        <div class="meta" style="margin-top:10px">
          <div class="qty" aria-label="Cantidad">
            <button data-dec="${id}" aria-label="Disminuir">‚àí</button>
            <input data-qty="${id}" inputmode="numeric" pattern="[0-9]*" value="${qty}" aria-label="Cantidad" />
            <button data-inc="${id}" aria-label="Aumentar">+</button>
          </div>
          <button class="btn danger" data-rm="${id}">Quitar</button>
        </div>
      `;
      cartEl.appendChild(el);
    });

    
      // Botones + / - / Quitar y edici√≥n directa del input
    cartEl.querySelectorAll('[data-inc]').forEach(b => b.addEventListener('click', () => changeQty(b.getAttribute('data-inc'), +1)));
    cartEl.querySelectorAll('[data-dec]').forEach(b => b.addEventListener('click', () => changeQty(b.getAttribute('data-dec'), -1)));
    cartEl.querySelectorAll('[data-rm]').forEach(b => b.addEventListener('click', () => removeFromCart(b.getAttribute('data-rm'))));

    cartEl.querySelectorAll('[data-qty]').forEach(inp => {
      inp.addEventListener('change', () => {
        const id = inp.getAttribute('data-qty');
        const n = clampInt(inp.value, 1, 999);
        setQty(id, n);
      });
      inp.addEventListener('input', () => {
        // keep only digits
        inp.value = inp.value.replace(/[^0-9]/g, '');
      });
    });

    updateTotals();
  }


      // ‚úÖ (10) ACTUALIZA LOS TOTALES EN PANTALLA

  function updateTotals(){
    const { distinct, units, subtotal, total } = countsAndTotals();
    cartCountEl.textContent = String(distinct);
    itemsCountEl.textContent = `${distinct} producto(s) ¬∑ ${units} unidad(es)`;
    subtotalEl.textContent = eur(subtotal);
    totalEl.textContent = eur(total);
  }

    // ‚úÖ (11) ACCIONES DEL CARRITO:
    // A√±adir, quitar, cambiar cantidad, vaciar.
  
  function addToCart(id){
    cart[id] = cart[id] || { id, qty: 0 };
    cart[id].qty += 1;
    saveCart();
    renderCart();
  }

  function removeFromCart(id){
    delete cart[id];
    saveCart();
    renderCart();
  }

  function setQty(id, qty){
    if(!cart[id]) cart[id] = { id, qty: 0 };
    cart[id].qty = Math.max(1, qty);
    saveCart();
    renderCart();
  }

  function changeQty(id, delta){
    if(!cart[id]) return;
    const next = cart[id].qty + delta;
    if(next <= 0){
      removeFromCart(id);
      return;
    }
    cart[id].qty = next;
    saveCart();
    renderCart();
  }

  function clearCart(){
    cart = {};
    saveCart();
    renderCart();
  }


  

  
  // ====== Google Sheets endpoint ======
  const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyfRCBjBN3zZ0cz8j2W0E2ONQ3qm-3xuFG44nRUaFqLWQ05SSl8t0Qu0BS2cz3zt554DQ/exec";


    // ‚úÖ (14) ‚ÄúCANDADO‚Äù PARA EVITAR DOBLE ENV√çO:
    // Si el usuario hace doble clic mientras est√° enviando, no se duplica.
  
let isSubmitting = false;


    // ‚úÖ (15) ENV√çO DEL PEDIDO A GOOGLE SHEETS:
    // - Valida carrito y datos
    // - Bloquea el bot√≥n (Enviando‚Ä¶)
    // - Genera orderId √∫nico (sirve para deduplicar en Sheets)
    // - Env√≠a por POST con no-cors (evita bloqueo del navegador)
  
async function submitOrder(){
  if (isSubmitting) return; // evita doble clic

  const btn = document.querySelector("#submitOrder");

  const items = cartItems();
  if(items.length === 0){
    toast("Carrito vac√≠o üôÇ");
    return;
  }

  const name = document.querySelector("#customerName").value.trim();
  const phone = document.querySelector("#customerPhone").value.trim();

  if(!name || !phone){
    toast("Falta nombre o tel√©fono");
    return;
  }

  // üîí bloqueamos el bot√≥n
  isSubmitting = true;
  const prevText = btn.textContent;
  btn.disabled = true;
  btn.textContent = "Enviando‚Ä¶";

  const totals = countsAndTotals();

  // ID √∫nico del pedido (sirve para deduplicar)
  const orderId = "W" + Date.now() + "_" + Math.random().toString(16).slice(2);

  const payload = {
    orderId,
    customerName: name,
    customerPhone: phone,
    total: totals.total,
    items: items.map(x => ({
      id: x.id,
      name: x.product.name,
      price: x.product.price,
      qty: x.qty,
      lineTotal: x.qty * x.product.price
    }))
  };

  try{
    await fetch(GOOGLE_SCRIPT_URL, {
      method: "POST",
      mode: "no-cors",
      body: JSON.stringify(payload),
      headers: { "Content-Type": "text/plain;charset=utf-8" }
    });

    toast("Pedido enviado ‚úÖ");
    clearCart();
    document.querySelector("#customerName").value = "";
    document.querySelector("#customerPhone").value = "";
  } catch (err){
    toast("Error de conexi√≥n ‚ùå");
  } finally {
    // üîì desbloqueamos
    isSubmitting = false;
    btn.disabled = false;
    btn.textContent = prevText;
  }
}




    // ‚úÖ (16) UTILIDADES DE UI:
    // - clampInt: asegura n√∫meros dentro de rango
    // - escapeHtml: evita que texto rompa el HTML
    // - toast: mensajitos bonitos abajo

  function clampInt(v, min, max){
    const n = parseInt(String(v||'').trim(), 10);
    if(Number.isNaN(n)) return min;
    return Math.min(max, Math.max(min, n));
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'",'&#039;');
  }

  function toast(msg){
    const el = document.createElement('div');
    el.textContent = msg;
    el.style.position = 'fixed';
    el.style.left = '50%';
    el.style.bottom = '18px';
    el.style.transform = 'translateX(-50%)';
    el.style.padding = '10px 12px';
    el.style.borderRadius = '14px';
    el.style.border = '1px solid rgba(255,255,255,.14)';
    el.style.background = 'rgba(0,0,0,.55)';
    el.style.backdropFilter = 'blur(10px)';
    el.style.color = 'white';
    el.style.fontSize = '13px';
    el.style.zIndex = 9999;
    document.body.appendChild(el);
    setTimeout(() => { el.style.opacity = '0'; el.style.transition='opacity .25s'; }, 1200);
    setTimeout(() => el.remove(), 1550);
  }


    // ‚úÖ (17) INICIALIZACI√ìN:
    // Aqu√≠ ‚Äúenchufamos‚Äù los listeners (click, input) y pintamos cat√°logo + carrito al cargar.
  
 window.addEventListener("DOMContentLoaded", () => {
  qEl.addEventListener('input', renderProducts);
  $('#resetBtn').addEventListener('click', clearCart);
  document.querySelector("#submitOrder").addEventListener("click", submitOrder);

  // üõí NUEVO
  document.querySelector("#cartCount").addEventListener("click", () => {
    const cart = document.querySelector("#cartPanel");
    if (!cart) return;

    cart.scrollIntoView({
      behavior: "smooth",
      block: "start"
    });
  });

  renderProducts();
  renderCart();
});
  
</script>
</body>
</html>
