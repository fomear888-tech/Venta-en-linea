<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ‚úÖ T√çTULO DE LA PESTA√ëA DEL NAVEGADOR -->
  <title>Cat√°logo ¬∑ Carrito</title>
  
  <style>

/* ‚úÖ ESTILOS GENERALES (COLORES Y ‚ÄúTEMA‚Äù DE LA WEB) Aqu√≠ defines los colores base y el look (fondo, textos, bordes, botones). */
    
    :root{
  --bg:#ffffff;
  --card:#ffffff;
  --muted:#6b7280;
  --txt:#111827;
  --accent:#10b981;      /* verde elegante */
  --danger:#ef4444;
  --border:rgba(0,0,0,.08)
}
    /* ‚úÖ REGLAS B√ÅSICAS PARA QUE TODO SE VEA ORDENADO */
    *{box-sizing:border-box}
    body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
  background:#f9fafb;
  color:var(--txt)
}

    /* ‚úÖ CABECERA FIJA (BUSCADOR, ICONO DEL CARRITO, BOT√ìN VACIAR) */
    header{
  position:sticky;
  top:0;
  z-index:10;
  background:#ffffff;
  border-bottom:1px solid var(--border);
}

    /* ‚úÖ CONTENEDOR ‚ÄúCENTRADO‚Äù (ANCHO M√ÅXIMO) */
    .wrap{max-width:1100px;margin:0 auto;padding:18px 16px}

    /* ‚úÖ ESTRUCTURA DE LA PARTE SUPERIOR */
    .top{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:40px;height:40px;border-radius:14px;background:radial-gradient(circle at 30% 20%, var(--accent), transparent 55%), linear-gradient(135deg,#2b2f55,#111a33); border:1px solid var(--border)}
    h1{font-size:18px;margin:0;letter-spacing:.3px}
    .sub{color:var(--muted);font-size:12px;margin-top:2px}
    

    /* ‚úÖ BUSCADOR, ‚ÄúP√çLDORAS‚Äù Y BOTONES DE LA CABECERA */
    .actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .search{display:flex;align-items:center;gap:10px;padding:10px 12px;border:1px solid var(--border);border-radius:14px;background:#ffffff;min-width:min(420px, 92vw)}
    .search input{
  width:100%;
  border:none;
  outline:none;
  background:transparent;
  box-shadow:none;
  padding:0;
  margin:0;
  color:var(--txt);
  font-size:14px;
}

    .search{
  overflow:hidden;
}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:14px;border:1px solid var(--border);background:#ffffff;color:var(--txt);cursor:pointer;user-select:none}
    .pill strong{font-weight:700}
    .pill:hover{border-color:rgba(94,234,212,.35)}

    /* ‚úÖ LAYOUT PRINCIPAL: CATALOGO A LA IZQ / CARRITO A LA DER (EN M√ìVIL SE APILAN) */
    .grid{display:grid;grid-template-columns:1.25fr .85fr;gap:16px;align-items:start}
@media (max-width: 920px){.grid{grid-template-columns:1fr}}
    @media (max-width: 920px){main .grid{grid-template-columns:1fr}}

    .grid.onecol{
  grid-template-columns: 1fr !important;
}

    /* ‚úÖ ‚ÄúCAJAS‚Äù TIPO PANEL PARA CATALOGO Y CARRITO */
    .panel{
  border:1px solid var(--border);
  border-radius:18px;
  background:#ffffff;
  overflow:hidden;
}
    .panel h2{margin:0;padding:14px 14px;border-bottom:1px solid var(--border);font-size:14px;letter-spacing:.25px}
    .panel .content{padding:14px}


    /*sombra para las cajas*/
    .panel, .card{
  box-shadow: 0 6px 18px rgba(0,0,0,.04);
}




/* ‚úÖ Cards clickeables (tipo ‚Äúobjeto tocable‚Äù) */
.card{
  cursor: pointer;
  transition: transform .12s ease, box-shadow .15s ease, border-color .15s ease;
}

.card:hover{
  transform: translateY(-2px);
  box-shadow: 0 14px 34px rgba(0,0,0,.10);
  border-color: rgba(16,185,129,.28);
}

.card:active{
  transform: translateY(0px) scale(.99);
}

/* ‚úÖ En m√≥vil no hay hover real; igual se ve bien */
@media (hover: none){
  .card:hover{ transform:none; box-shadow: 0 6px 18px rgba(0,0,0,.04); }
}




    /*para resaltar*/

.card .btn{
  cursor: pointer;
}


    

    /* ‚úÖ GRID DE PRODUCTOS (3 columnas / 2 / 1 seg√∫n pantalla) */
    .products{display:grid;grid-template-columns:repeat(3, minmax(0,1fr));gap:12px}
    @media (max-width: 920px){.products{grid-template-columns:repeat(2, minmax(0,1fr))}}
    @media (max-width: 520px){
  .products{ grid-template-columns: repeat(2, minmax(0,1fr)); }
}


    @media (max-width: 520px){
  .card{ padding:10px; }
  .title{ font-size:13px; }
  .desc{ font-size:11px; }
  .btn{ padding:8px 9px; }
}


    /* ‚úÖ TARJETAS DE PRODUCTO + BOTONES */
    .card{border:1px solid var(--border);border-radius:16px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02))}
    .tag{display:inline-flex;align-items:center;font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);color:var(--muted)}
    .title{margin:10px 0 6px;font-size:14px;font-weight:700}
    .desc{margin:0 0 12px;color:var(--muted);font-size:12px;line-height:1.35}
    .row{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .price{font-weight:800}
    .btn{border:1px solid rgba(94,234,212,.35);background:rgba(94,234,212,.10);color:var(--txt);padding:9px 10px;border-radius:12px;cursor:pointer;font-weight:700}
    .btn:hover{background:rgba(94,234,212,.16)}
    .btn:active{transform:translateY(1px)}
    .btn.secondary{border-color:var(--border);background:rgba(255,255,255,.03)}
    .btn.danger{border-color:rgba(255,107,107,.35);background:rgba(255,107,107,.10)}

.btn.pay{
  border-color: rgba(94,234,212,.55);
  background: linear-gradient(180deg, rgba(94,234,212,.28), rgba(94,234,212,.12));
}
.btn.pay:hover{ filter: brightness(1.05); }
.btn.pay[aria-disabled="true"]{
  opacity:.45;
  pointer-events:none;
}
    
  
/* ‚úÖ IM√ÅGENES DE PRODUCTO */
.pimg{
  width:100%;
  aspect-ratio: 4 / 3;
  border-radius:14px;
  border:1px solid var(--border);
  background:#ffffff;
  overflow:hidden;
  margin-bottom:10px;
}
.pimg img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}


    /* Para mostrar el stock bonito (unidades en existencia) */
    .stockline{display:flex;justify-content:space-between;align-items:center;margin:8px 0 10px}
    .stock{font-size:12px;color:var(--muted)}
    .badgeOut{font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid rgba(255,107,107,.35);background:rgba(255,107,107,.10);color:var(--txt)}
    .btn[disabled]{opacity:.45;cursor:not-allowed}


    
    /* ‚úÖ CARRITO: LISTA DE ITEMS Y CONTROLES DE CANTIDAD */
    .cartList{display:flex;flex-direction:column;gap:10px}
    .cartItem{
  border:1px solid var(--border);
  border-radius:16px;
  padding:12px;
  background:#ffffff;
}
    .cartItem .name{font-weight:800;font-size:13px;margin:0 0 6px}
    .meta{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .muted{color:var(--muted);font-size:12px}

    .qty{display:inline-flex;align-items:center;gap:8px}
    .qty button{width:34px;height:34px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.03);color:var(--txt);cursor:pointer;font-size:16px}
    .qty button:hover{border-color:rgba(94,234,212,.35)}
    .qty input{width:58px;text-align:center;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.03);color:var(--txt);padding:8px 10px;outline:0}


    /* ‚úÖ TOTALES (SUBTOTAL / TOTAL) */
    .totals{border-top:1px solid var(--border);margin-top:12px;padding-top:12px}
    .totals .line{display:flex;justify-content:space-between;align-items:center;margin:6px 0}
    .totals .grand{font-size:16px;font-weight:900}


    /* ‚úÖ PIE DE P√ÅGINA */
    .empty{color:var(--muted);font-size:13px;line-height:1.45;margin:0}
    footer{color:var(--muted);font-size:12px;text-align:center;padding:18px 16px}
    code{background:rgba(255,255,255,.06);padding:2px 6px;border-radius:8px}

  
/* Para el carrito */
#cartPanel {
  scroll-margin-top: 90px;
}


    /* ‚úÖ Ocultar secciones hasta que el usuario elija */
#servicesInfo,
#catalogo{
  display: none;
}



    /* ‚úÖ FORZAR INPUTS EN MODO BLANCO (para que los estilos inline oscuros no dominen) */
input, select, textarea{
  background:#ffffff !important;
  color:#111827 !important;
  border:1px solid rgba(0,0,0,.12) !important;
}



    /* ‚úÖ Quitar ‚Äúcuadrito‚Äù del input dentro del buscador */
.search input{
  border: none !important;
  background: transparent !important;
  box-shadow: none !important;
  outline: none !important;
  padding: 0 !important;
  margin: 0 !important;
  -webkit-appearance: none !important;
  appearance: none !important;
}

/* ‚úÖ Quitar decoraciones internas de type="search" en Chrome/Safari */
.search input[type="search"]::-webkit-search-decoration,
.search input[type="search"]::-webkit-search-cancel-button,
.search input[type="search"]::-webkit-search-results-button,
.search input[type="search"]::-webkit-search-results-decoration{
  -webkit-appearance: none;
}



/*para bloques*/


/* ‚úÖ BLOQUES INICIO: Servicios / Productos */
.homeBlocks{
  display:grid;
  grid-template-columns: 1fr 1.5fr;
  gap:16px;
  margin-top:16px;
}
@media (max-width: 920px){
  .homeBlocks{ grid-template-columns: 1fr; }
}

.homeCard{
  border:1px solid var(--border);
  border-radius:18px;
  background:#ffffff;
  box-shadow:0 6px 18px rgba(0,0,0,.04);
  padding:16px;
}

.homeCard h2{
  margin:0 0 6px;
  font-size:18px;
}

.homeCard p{
  margin:0;
  color:var(--muted);
  font-size:13px;
  line-height:1.4;
}

.homeCard .go{
  margin-top:12px;
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid var(--border);
  background:#ffffff;
  color:var(--txt);
  cursor:pointer;
  text-decoration:none;
  font-weight:700;
}
.homeCard .go:hover{
  border-color: rgba(16,185,129,.35);
}

    

html{ scroll-behavior:smooth; }



/* ‚úÖ Modo pantalla inicial */
#homeScreen{ display:block; }

/* Ocultas contenido hasta elegir */
#servicesInfo, #catalogo{ display:none; }

/* Los recuadros grandes parecen ‚Äúbotones‚Äù */
.homeCard{
  cursor:pointer;
  transition: transform .08s ease, box-shadow .12s ease;
}
.homeCard:hover{ box-shadow:0 10px 26px rgba(0,0,0,.08); }
.homeCard:active{ transform: translateY(1px); }

/* Bot√≥n volver */
.backBar{
  display:flex;
  align-items:center;
  gap:10px;
  margin: 12px 0 16px;
}
.backBtn{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid var(--border);
  background:#ffffff;
  color:var(--txt);
  cursor:pointer;
  font-weight:800;
}
.backBtn:hover{ border-color: rgba(16,185,129,.35); }


    /* ‚úÖ Oculta acciones del header cuando NO est√°s en Productos */
#headerActions.hidden{
  display:none !important;
}



.logo{ display:none; } /* opcional: por si queda algo viejo */

.logoImg{
  width:40px;
  height:40px;
  border-radius:14px;
  object-fit:cover;
  border:1px solid var(--border);
  background:#fff;
}



    /* ‚ú® Inputs bonitos para checkout */
.checkout-input{
  width: 100%;
  padding: 14px 16px;          /* aire interno */
  font-size: 15px;             /* letra m√°s c√≥moda */
  border-radius: 14px;         /* esquinas suaves */
  border: 1px solid var(--border);
  background: #ffffff;
  color: var(--txt);
  line-height: 1.4;
  transition: border-color .15s ease, box-shadow .15s ease;
}

.checkout-input::placeholder{
  color: var(--muted);
}

/* efecto foco (cuando escribes) */
.checkout-input:focus{
  outline: none;
  border-color: rgba(16,185,129,.55);
  box-shadow: 0 0 0 3px rgba(16,185,129,.15);
}
    





/* ‚úÖ Modal tipo Instagram */
.igModal{ position:fixed; inset:0; display:none; z-index:9999; }
.igModal.open{ display:block; }

.igBackdrop{
  position:absolute; inset:0;
  background:rgba(0,0,0,.55);
  backdrop-filter: blur(6px);
}

.igSheet{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%) scale(.98);
  width:min(920px, 94vw);
  max-height:min(86vh, 720px);
  background:#fff;
  border:1px solid rgba(0,0,0,.10);
  border-radius:22px;
  overflow:hidden;
  box-shadow:0 20px 60px rgba(0,0,0,.22);
  display:grid;
  grid-template-columns: 1.2fr 0.8fr;
  animation: igIn .14s ease-out;
}

@keyframes igIn{
  from{ opacity:0; transform:translate(-50%,-48%) scale(.98); }
  to{ opacity:1; transform:translate(-50%,-50%) scale(1); }
}

@media (max-width: 860px){
  .igSheet{
    display:flex;              /* üëà en m√≥vil mejor que grid */
    flex-direction:column;
    height: min(85vh, 720px);  /* üëà alto fijo del modal */
  }

  .igMedia{
    flex: 0 0 auto;
    height: 320px;             /* ya lo ten√≠as, lo respetamos */
  }

  .igInfo{
    flex: 1 1 auto;            /* üëà ocupa el resto */
    min-height: 0;             /* üëà CLAVE para que el overflow funcione en flex */
  }
}



.igClose{
  position:absolute; right:12px; top:12px;
  width:40px; height:40px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.10);
  background:#fff;
  cursor:pointer;
  font-size:18px;
  z-index:3;
}





/* ‚úÖ √Årea de imagen con tama√±o uniforme */
.igMedia{
  background:#0b0f14;          /* barras negras suaves */
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;

  /* tama√±o uniforme */
  height: 520px;               /* escritorio */
  overflow:hidden;
}

@media (max-width: 860px){
  .igMedia{
    height: 320px;             /* m√≥vil */
  }
}

/* ‚úÖ Mostrar imagen completa con barras (sin recorte) */
.igMedia img{
  width:100%;
  height:100%;
  object-fit: contain;         /* üëà clave: NO recorta */
  display:block;
}

/* ‚úÖ Puntitos SIEMPRE en el mismo sitio */
.igDots{
  position: absolute;
  left: 50%;
  bottom: 36px;          /* s√∫belos un poco */
  transform: translateX(-50%);
  display: flex;
  gap: 8px;
  z-index: 4;
}

.igDot{
  width:7px;
  height:7px;
  border-radius:999px;
  background: rgba(255,255,255,.45);
}
.igDot.active{
  background: var(--accent);
}






    



    

/* ‚úÖ Flechas grandes estilo Amazon */
.igNav{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  background:none;
  border:none;
  cursor:pointer;
  font-size:64px;          /* üëà tama√±o grande */
  font-weight:300;
  color:white;
  text-shadow: 0 4px 14px rgba(0,0,0,.55);
  padding:0 14px;
  line-height:1;
  user-select:none;
}

/* Posici√≥n */
.igNav.left{ left:0; }
.igNav.right{ right:0; }

/* Hover elegante */
@media (hover:hover){
  .igNav{
    opacity:0;
    transition: opacity .2s ease;
  }
  .igMedia:hover .igNav{
    opacity:1;
  }
}

/* M√≥vil: siempre visibles */
@media (max-width: 860px){
  .igNav{
    opacity:1 !important;
    font-size:56px;
  }
}

.igNav.left{ left:10px; }
.igNav.right{ right:10px; }

.igInfo{
  padding:16px 16px 18px;
  overflow:auto;
  -webkit-overflow-scrolling: touch; /* üëà scroll suave en m√≥vil */
  overscroll-behavior: contain;      /* üëà evita ‚Äúarrastrar‚Äù la p√°gina detr√°s */
}

    
.igTag{
  display:inline-flex; align-items:center;
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.10);
  color:#6b7280;
}
.igTitle{ margin:10px 0 8px; font-size:18px; }
.igDesc{ margin:0 0 12px; color:#6b7280; line-height:1.45; font-size:13px; }

.igMeta{
  display:flex; justify-content:space-between; gap:12px;
  align-items:center;
  padding:12px 0;
  border-top:1px solid rgba(0,0,0,.08);
  border-bottom:1px solid rgba(0,0,0,.08);
  margin-bottom:12px;
}
.igPrice{ font-weight:900; font-size:18px; }
.igStock{ color:#6b7280; font-size:13px; }

.igBtn{
  width:100%;
  padding:14px 16px;
  border-radius:14px;
  border:1px solid rgba(16,185,129,.35);
  background:rgba(16,185,129,.12);
  font-weight:900;
  cursor:pointer;
}
.igBtn:hover{ filter:brightness(1.03); }










    .igDesc{
  margin: 8px 0 12px;
  color: var(--muted);
  line-height: 1.5;
  font-size: 13px;
  white-space: pre-line; /* üëà esto es la clave para saltos de l√≠nea */
  background: transparent;
  border: 0;
  padding: 0;
  border-radius: 0;
}

    




/* ‚úÖ Zoom fullscreen (lightbox) */
.igZoom{
  position: fixed;
  inset: 0;
  display: none;
  z-index: 10000; /* por encima del modal */
}
.igZoom.open{ display:block; }

.igZoomBg{
  position:absolute; inset:0;
  background: rgba(0,0,0,.86);
}

.igZoomImg{
  position:absolute;
  inset: 16px;
  width: calc(100% - 32px);
  height: calc(100% - 32px);
  object-fit: contain;            /* üëà NO recorta, muestra completa */
  background: transparent;
}

.igZoomClose{
  position:absolute;
  top: 14px;
  right: 14px;
  width: 44px;
  height: 44px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.35);
  color: #fff;
  font-size: 22px;
  cursor: pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index: 2;
}

.igMedia img{ cursor: zoom-in; }  /* el cursor de ‚Äúquiero ampliar‚Äù */






    .panelHead{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:14px 14px;
  border-bottom:1px solid var(--border);
}

.panelHead h2{
  margin:0;
  padding:0;            /* importante: ya no usamos padding del h2 viejo */
  border-bottom:none;   /* importante */
  font-size:14px;
  letter-spacing:.25px;
}


    



    /* üì± M√≥vil: buscador + carrito en una sola l√≠nea */
@media (max-width: 520px){

  .top{
    flex-wrap: nowrap;              /* üëà NO saltar de l√≠nea */
    align-items: center;
  }

  .actions{
    flex-wrap: nowrap;              /* üëà todo en una fila */
    width: 100%;
    gap:8px;
  }

  .search{
    min-width: 0;                   /* üëà clave: permite encogerse */
    flex: 1;                        /* ocupa todo lo posible */
  }

  #cartCount{
    flex-shrink: 0;                 /* üëà que el carrito NO se encoja */
  }
}






    /* üì± Buscador expandido en m√≥vil */
@media (max-width: 600px){
  .top.search-active .search{
    flex: 1;
  }

  .top.search-active #cartCount{
    opacity: 0;
    pointer-events: none;
    width: 0;
    margin: 0;
  }

  .search{
    transition: flex .25s ease;
  }

  #cartCount{
    transition: opacity .2s ease, width .2s ease;
  }
}






    button,
a,
.card,
.pill{
  -webkit-tap-highlight-color: transparent;
}





    /* ‚úÖ Pesta√±as superiores tipo Amazon */
.tabs{
  display:flex;
  gap:8px;
  align-items:center;
  flex-wrap:wrap;
}

.tab{
  padding:10px 12px;
  border-radius:14px;
  border:1px solid var(--border);
  background:#fff;
  color:var(--txt);
  cursor:pointer;
  font-weight:800;
  font-size:13px;
  user-select:none;
  transition: border-color .15s ease, transform .08s ease, box-shadow .15s ease;
}

.tab:hover{
  border-color: rgba(16,185,129,.35);
  box-shadow: 0 6px 18px rgba(0,0,0,.04);
}

.tab:active{ transform: translateY(1px); }

.tab.active{
  border-color: rgba(16,185,129,.55);
  box-shadow: 0 0 0 3px rgba(16,185,129,.12);
}

/* üì± En m√≥vil, que no rompa la cabecera */
@media (max-width: 520px){
  .tabs{ width:100%; }
  .tab{ padding:9px 10px; font-size:12px; }
}




    
    


    
  </style>
</head>
<body>

  
  <!-- ‚úÖ CABECERA: Marca + buscador + contador de carrito + vaciar -->
<header>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <img class="logoImg" src="img/logo-masenvios.png" alt="Mas Env√≠os">
        <div>
          <h1>MASENVIOS</h1>
          <div class="sub">Tu servicio de confianza.</div>
        </div>
      </div>





      <nav class="tabs" aria-label="Navegaci√≥n">
  <button class="tab" data-view="home" type="button">Inicio</button>
  <button class="tab" data-view="services" type="button">Servicios</button>
  <button class="tab" data-view="catalog" type="button">Productos</button>
</nav>




      


      
      <div class="actions" id="headerActions">

        <div class="search" role="search">
          <span aria-hidden="true">üîé</span>
          <input id="q" type="search" placeholder="Buscar productos‚Ä¶" autocomplete="off" />
        </div>
        <div class="pill" id="cartCount" title="Productos en el carrito">üõí <strong>0</strong></div>
      </div>
    </div>
  </div>
</header>












  <!-- ‚úÖ CUERPO: 2 PANELES: CATALOGO (izq) + CARRITO (der) -->
<main>
  <div class="wrap">

   <!-- ‚úÖ BLOQUES DE INICIO: SERVICIOS / PRODUCTOS -->
<section class="wrap homeBlocks" id="homeScreen" aria-label="Inicio">

  <div class="homeCard" id="servicesBlock">
    <h2>Servicios</h2>
    <p>
      Aqu√≠ puedes mostrar informaci√≥n: citas, tr√°mites, impresiones, fotocopias, etc.
      (Solo informativo, sin compra).
    </p>
    <p class="muted" style="margin-top:10px;">
      Haz clic para ver la informaci√≥n.
    </p>
  </div>

  <div class="homeCard" id="productsBlock">
    <h2>Productos</h2>
    <p>
      Aqu√≠ est√° el cat√°logo con el carrito y el pago.
    </p>
    <p class="muted" style="margin-top:10px;">
      Haz clic para ver el cat√°logo.
    </p>
  </div>

</section>


<section class="panel" id="servicesInfo" aria-label="Servicios">
  <h2>Servicios</h2>
  <div class="content">





    
    <div class="backBar">
      <button class="backBtn" id="backHomeFromServices">‚Üê Volver</button>
  </div>

    <p class="empty" style="margin:0;">
      üìÑ Citas (Seguridad Social, SEPE, Extranjer√≠a) ¬∑ üñ®Ô∏è Impresiones y fotocopias ¬∑ üì© Escaneo y env√≠o de documentos ¬∑ üí≥ Recargas / accesorios.
      <br><br>
      Para solicitar un servicio, cont√°ctanos por WhatsApp o en el local. (Aqu√≠ no se compra, solo info.)
    </p>
  </div>
</section>





   <div id="catalogo" style="display:none;">

  <div class="backBar">
    <button class="backBtn" id="backHomeFromProducts">‚Üê Volver</button>
  </div>

  <div class="grid onecol">
    <!-- ‚úÖ PANEL CATALOGO -->
    <section class="panel" aria-label="Cat√°logo">
      <h2>Cat√°logo</h2>
      <div class="content">
        <div id="products" class="products"></div>
      </div>
    </section>

    <!-- (Opcional) si NO quieres carrito al lado en desktop, qu√≠talo.
         Si lo quieres al lado, d√©jalo. Si quieres solo pantalla separada, qu√≠talo.
         Yo lo quito para respetar tu ‚Äúpantalla independiente‚Äù. -->
  </div>

</div> <!-- /catalogo -->


<!-- üõí VISTA CARRITO (pantalla independiente) -->
<section id="cartView" style="display:none">

  <div class="backBar">
    <button class="backBtn" id="backToCatalog">‚Üê Volver al cat√°logo</button>
  </div>

  <aside class="panel" aria-label="Carrito" id="cartPanel">

  <div class="panelHead">
    <h2>Carrito</h2>
    <button class="pill" id="resetBtn" title="Vaciar carrito">üßπ Vaciar</button>
  </div>

  <div class="content">


      
      <div id="cart" class="cartList"></div>

      <div class="totals">
        <div class="line">
          <span class="muted">Productos</span>
          <span id="itemsCount" class="muted">0</span>
        </div>

        <div class="line">
          <span class="muted">Subtotal</span>
          <span id="subtotal" class="muted">0,00 ‚Ç¨</span>
        </div>

        <div class="line grand">
          <span>Total</span>
          <span id="total">0,00 ‚Ç¨</span>
        </div>

        <div style="display:grid; gap:10px; margin:12px 0;">
          <input id="customerName" class="checkout-input" name="customerName" type="text" autocomplete="name" placeholder="Nombre y apellidos">
          <input id="customerPhone" class="checkout-input" name="customerPhone" type="tel" inputmode="numeric" autocomplete="tel" placeholder="Tel√©fono" pattern="[0-9]*">
        </div>

        <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
          <a class="btn pay" id="payBtn" href="#" role="button" aria-disabled="true">‚úÖ Confirmar pedido</a>
        </div>

        <p class="muted" style="margin:10px 0 0">Aseg√∫rese de ingresar los datos correctamente</p>
      </div>
    </div>
  </aside>

</section>


      

  </div>
</div>


    

    </div>
  </div>
</main>




<!-- ‚úÖ ADMIN (solo t√∫) -->
<section class="panel" id="adminPanel" style="max-width:1100px;margin:16px auto;display:none;">
  <h2>Admin ¬∑ Productos e im√°genes</h2>
  <div class="content" style="display:grid;gap:12px;">
    

    <div id="adminAuthBox" style="display:grid;gap:10px;">
      <div class="muted">Acceso admin (solo para ti). Usa <code>?admin=1</code> en la URL.</div>
      <input id="adminEmail" placeholder="Email" style="padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.03);color:#eaf0ff;outline:0;">
      <input id="adminPass" type="password" placeholder="Contrase√±a" style="padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.03);color:#eaf0ff;outline:0;">
      <button class="btn" id="adminLoginBtn">Entrar</button>
    </div>

<div id="adminToolsBox" style="display:none; gap:12px;">
      <div class="muted">Modo admin activo ‚úÖ</div>

      <div style="display:grid;gap:10px;">
        <label class="muted">Producto</label>
        <select id="adminProduct" style="padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.03);color:#eaf0ff;outline:0;"></select>
      </div>

      





  <div style="display:grid;gap:10px;">
  <label class="muted">Foto del producto</label>
  <select id="adminImgSlot"
    style="padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.03);color:#eaf0ff;outline:0;">
    <option value="img">Foto 1 (principal)</option>
    <option value="img2">Foto 2</option>
    <option value="img3">Foto 3</option>
    <option value="img4">Foto 4</option>
    <option value="img5">Foto 5</option>
  </select>
</div>

<div style="display:grid;gap:10px;">
  <label class="muted">Archivo (JPG/PNG/WebP)</label>
  <input id="adminFile" type="file" accept="image/*"
    style="padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.03);color:#eaf0ff;outline:0;">
</div>





  

      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <button class="btn" id="adminUploadBtn">Subir y asignar</button>
        <button class="btn secondary" id="adminRefreshBtn">Recargar productos</button>
        <button class="btn danger" id="adminLogoutBtn">Salir</button>
      </div>

      <div class="muted" id="adminStatus"></div>
    </div>

  </div>
</section>




  


  <!-- ‚úÖ PIE -->

<footer>
<code>¬© 2026 ¬∑ Mas Env√≠os ¬∑ Todos los derechos reservados</code>
</footer>







<!-- ‚úÖ MODAL TIPO INSTAGRAM -->
<div id="igModal" class="igModal" aria-hidden="true">
  <div class="igBackdrop" data-close></div>

  <div class="igSheet" role="dialog" aria-modal="true" aria-label="Detalle del producto">
    <button class="igClose" type="button" data-close aria-label="Cerrar">‚úï</button>

    <div class="igMedia">
      <button class="igNav left" type="button" id="igPrev" aria-label="Anterior">‚Äπ</button>
      <img id="igImg" alt="">

  <!-- ‚úÖ Puntitos dentro de la imagen -->
  <div class="igDots" id="igDots"></div>

      
      <button class="igNav right" type="button" id="igNext" aria-label="Siguiente">‚Ä∫</button>
    </div>


    



    

    <div class="igInfo">
      <div class="igTag" id="igCat"></div>
      <h3 class="igTitle" id="igName"></h3>
      <p class="igDesc" id="igDesc"></p>

      <div class="igMeta">
        <div class="igPrice" id="igPrice"></div>
        <div class="igStock" id="igStock"></div>
      </div>

      <button class="igBtn" id="igAddBtn" type="button">A√±adir al carrito</button>
    </div>
  </div>
</div>







<!-- ‚úÖ ZOOM FULLSCREEN -->
<div id="igZoom" class="igZoom" aria-hidden="true">
  <div class="igZoomBg" data-zoom-close></div>
  <button class="igZoomClose" type="button" data-zoom-close aria-label="Cerrar">‚úï</button>
  <img id="igZoomImg" class="igZoomImg" alt="">
</div>
  

  




  

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  
<script>
  const SUPABASE_URL = "https://pujzkraozoqbriqnlikf.supabase.co";
  const SUPABASE_ANON_KEY = "sb_publishable_D7A6JAiqiXAaPRYsaF6ZBQ_1hCE1UcN";

  // üëá cliente real (le ponemos otro nombre para evitar l√≠os)
  const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
</script>


 
  
<script>


async function isAdmin(){
  const { data: { user } } = await sb.auth.getUser();
  if(!user) return false;

  const { data, error } = await sb
    .from('admins')
    .select('user_id')
    .eq('user_id', user.id)
    .maybeSingle();

  if(error) return false;
  return !!data;
}



function wantsAdminUI(){
  return new URLSearchParams(location.search).get('admin') === '1';
}



// üîê Cierra la sesi√≥n si NO est√°s en ?admin=1
async function autoLogoutIfNotAdminPage() {
  if (!wantsAdminUI()) {
    const { data: { user } } = await sb.auth.getUser();
    if (user) {
      await sb.auth.signOut();
      console.log("Admin session closed automatically ‚úÖ");
    }
  }
}


  

async function showAdminPanel(){
  const panel = document.getElementById('adminPanel');
  if(!panel) return;

  // Solo si entras con ?admin=1
  if(!wantsAdminUI()){
    panel.style.display = 'none';
    return;
  }


  
  

  panel.style.display = 'block';

  const authBox  = document.getElementById('adminAuthBox');
  const toolsBox = document.getElementById('adminToolsBox');

  const ok = await isAdmin();

  // Si es admin: muestra herramientas. Si no: muestra login
  if(ok){
    authBox.style.display = 'none';
    toolsBox.style.display = 'grid';
    fillAdminProducts();
  } else {
    toolsBox.style.display = 'none';
    authBox.style.display = 'grid';
  }
}

async function adminLogin(){
  const email = document.getElementById('adminEmail')?.value.trim();
  const pass  = document.getElementById('adminPass')?.value.trim();
  if(!email || !pass) return toast("Pon email y contrase√±a");

  const { data, error } = await sb.auth.signInWithPassword({ email, password: pass });

  if(error){
    console.error("LOGIN ERROR:", error);
    toast("Login fall√≥ ‚ùå " + (error.message || ""));
    return;
  }

  console.log("LOGIN OK:", data);
  toast("Login OK ‚úÖ");
  await loadProductsFromSupabase();
  await showAdminPanel();
}
  

async function adminLogout(){
  await sb.auth.signOut();
  toast("Sesi√≥n cerrada üëã");
  await showAdminPanel();
}

function fillAdminProducts(){
  const sel = document.getElementById('adminProduct');
  if(!sel) return;
  if(!PRODUCTS || PRODUCTS.length === 0) { sel.innerHTML = ''; return; }

  sel.innerHTML = '';
  PRODUCTS.forEach(p => {
    const opt = document.createElement('option');
    opt.value = p.id;
    opt.textContent = `${p.name} (${p.id})`;
    sel.appendChild(opt);


const slotSel = document.getElementById("adminImgSlot");
if (slotSel) slotSel.value = "img";
    
  });
}

async function adminUploadAndAssign(){
  const status = document.getElementById('adminStatus');
  const sel = document.getElementById('adminProduct');
  const slotSel = document.getElementById('adminImgSlot');
  const fileInput = document.getElementById('adminFile');
  const btn = document.getElementById('adminUploadBtn');

  if(!sel?.value) return toast("Selecciona un producto");
  const productId = sel.value;
  const slot = (slotSel?.value || "img").trim(); // img, img2, img3, img4, img5


  

  const file = fileInput?.files?.[0];
  if(!file) return toast("Selecciona una imagen");
  if(file.size > 3 * 1024 * 1024) return toast("Imagen muy grande (m√°x 3MB)");

  btn.disabled = true;
  const prev = btn.textContent;
  btn.textContent = "Subiendo‚Ä¶";
  if(status) status.textContent = "";

  try{
    const ext = (file.name.split('.').pop() || 'jpg').toLowerCase();
    const path = `products/${productId}_${slot}.${ext}`;

    const { error: upErr } = await sb.storage
      .from('product-images')
      .upload(path, file, { upsert: true, contentType: file.type });

    if (upErr) {
  console.error(upErr);
  const msg = upErr.message || JSON.stringify(upErr);
  toast("Error subiendo imagen ‚ùå " + msg);
  if (status) status.textContent = msg;
  return;
}

    const { data: pub } = sb.storage.from('product-images').getPublicUrl(path);
    const publicUrl = pub?.publicUrl;
    if(!publicUrl) return toast("No pude obtener URL p√∫blica ‚ùå");

    const { error: updErr } = await sb
      .from('products')
      .update({ [slot]: publicUrl })
      .eq('id', productId);

    if(updErr){
      console.error(updErr);
      toast("Error guardando en products ‚ùå");
      if(status) status.textContent = updErr.message || String(updErr);
      return;
    }

    toast("Imagen asignada ‚úÖ");
    if(status) status.textContent = "OK: " + publicUrl;

    await loadProductsFromSupabase();

  } finally {
    btn.disabled = false;
    btn.textContent = prev;
    if(fileInput) fileInput.value = "";
  }
}




  


  
  const $ = (s) => document.querySelector(s);

  let PRODUCTS = [];
  const productsEl = $('#products');
  const cartEl = $('#cart');
if (!productsEl) console.warn("Falta #products en el DOM");
if (!cartEl) console.warn("Falta #cart en el DOM");

  
  const qEl = $('#q');

  const cartCountEl = $('#cartCount strong');
  const itemsCountEl = $('#itemsCount');
  const subtotalEl = $('#subtotal');
  const totalEl = $('#total');

  const STORAGE_KEY = 'cart_v1';
  let cart = loadCart();

  const eur = (n) =>
    new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR' }).format(n);

  // ====== CARGAR PRODUCTOS (TABLA: products) ======
  async function loadProductsFromSupabase() {
    const { data, error } = await sb.from("products").select("*")
      .order("name", { ascending: true });

    if (error) {
      console.error(error);
      toast("Error cargando productos ‚ùå");
      return;
    }

    PRODUCTS = (data || []).map(row => ({
      id: row.id,
      name: row.name,
      category: row.category || "",
      price: Number(row.price) || 0,
      desc: row["desc"] || "",
      img: row.img || "img/placeholder.jpg",

      // Mas imagenes
      img2: row.img2 || "",
      img3: row.img3 || "",
      img4: row.img4 || "",
      img5: row.img5 || "",

      
      stock: Number(row.stock) || 0
    }));

    renderProducts();
    renderCart();
    fillAdminProducts();
  }

  // ====== TIEMPO REAL (TABLA: products) ======
  function subscribeRealtimeProducts() {
  sb
    .channel("realtime-products")
    .on(
      "postgres_changes",
      { event: "*", schema: "public", table: "products" },
      async () => {
  await loadProductsFromSupabase();   // carga stock
  const r = reconcileCartWithStock(false);

  if (r.changed) {
    renderCart();        // repinta
    updatePayButton();   // asegura el bot√≥n pagar
 
  }
}
    )
    .subscribe();
}

  // ====== LOCALSTORAGE ======
  function loadCart(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return {};
      const parsed = JSON.parse(raw);
      return parsed && typeof parsed === 'object' ? parsed : {};
    } catch { return {}; }
  }
  function saveCart(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(cart)); }



  function getProduct(id){ return PRODUCTS.find(p => p.id === id); }
  function stockFor(id){ return Number(getProduct(id)?.stock) || 0; }

  

function reconcileCartWithStock(showToast = true) {
  let changed = false;
  const removed = [];
  const adjusted = [];

  for (const id of Object.keys(cart)) {
    const stock = stockFor(id);
    const qty = cart[id]?.qty || 0;

    // Si el producto ya ni existe en PRODUCTS o stock = 0 => fuera
    if (!getProduct(id) || stock <= 0) {
      delete cart[id];
      changed = true;
      removed.push(id);
      continue;
    }

    // Si el cliente lleva m√°s de lo que hay, lo ajustamos
    if (qty > stock) {
      cart[id].qty = stock;
      changed = true;
      adjusted.push({ id, from: qty, to: stock });
    }

    // Si qued√≥ en 0 por cualquier raz√≥n => fuera
    if ((cart[id]?.qty || 0) <= 0) {
      delete cart[id];
      changed = true;
      removed.push(id);
    }
  }

  if (changed) saveCart();

  if (showToast && changed) {
    if (removed.length) toast("Algunos productos se agotaron y se quitaron del carrito üßπ");
    else toast("Ajust√© cantidades seg√∫n stock disponible ‚úÖ");
  }

  return { changed, removed, adjusted };
}

// Revalidaci√≥n ‚Äúde verdad‚Äù: recarga desde Supabase y luego reconcilia
async function validateCartBeforePay() {
  await loadProductsFromSupabase();        // trae stock actual
  const result = reconcileCartWithStock(true);
  renderCart();                            // repinta con el carrito ya ajustado

  // Si despu√©s de ajustar qued√≥ vac√≠o, no dejes pagar
  const { distinct } = countsAndTotals();
  if (distinct <= 0) return { ok: false, reason: "empty" };

  return { ok: true, result };
}



  

  // ====== HELPERS ======
  function qtyInCart(id){ return cart[id]?.qty || 0; }

  function cartItems(){
    return Object.values(cart)
      .map(ci => ({...ci, product: getProduct(ci.id)}))
      .filter(x => x.product);
  }

  function countsAndTotals(){
    const items = cartItems();
    const distinct = items.length;
    const units = items.reduce((a, x) => a + x.qty, 0);
    const subtotal = items.reduce((a, x) => a + x.qty * x.product.price, 0);
    return { distinct, units, subtotal, total: subtotal };
  }






// ‚úÖ MODAL tipo Instagram para productos
const igModal = document.getElementById("igModal");

if (!igModal) {
  console.warn("igModal no existe en el DOM todav√≠a");
}


  
const igImg   = document.getElementById("igImg");
const igDots  = document.getElementById("igDots");
const igName  = document.getElementById("igName");
const igCat   = document.getElementById("igCat");
const igDesc  = document.getElementById("igDesc");
const igPrice = document.getElementById("igPrice");
const igStock = document.getElementById("igStock");
const igAddBtn = document.getElementById("igAddBtn");
const igPrev = document.getElementById("igPrev");
const igNext = document.getElementById("igNext");




// ‚úÖ Zoom fullscreen para la imagen del modal (solo se configura UNA vez)
const igZoom = document.getElementById("igZoom");
const igZoomImg = document.getElementById("igZoomImg");

function openZoom(src, alt=""){
  if(!igZoom || !igZoomImg) return;
  igZoomImg.src = src;
  igZoomImg.alt = alt;
  igZoom.classList.add("open");
  igZoom.setAttribute("aria-hidden","false");
}

function closeZoom(){
  if(!igZoom || !igZoomImg) return;
  igZoom.classList.remove("open");
  igZoom.setAttribute("aria-hidden","true");
  igZoomImg.src = "";
}

// click en la imagen principal del modal ‚Üí abre zoom
igImg?.addEventListener("click", () => {
  if (!igImg?.src) return;
  openZoom(igImg.src, igImg.alt || "");
});

// cerrar tocando fondo o X
igZoom?.addEventListener("click", (e) => {
  if (e.target?.dataset?.zoomClose !== undefined) closeZoom();
});

// cerrar con ESC (solo el zoom)
window.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && igZoom?.classList.contains("open")) closeZoom();
});






  

let igCurrent = null;
let igIndex = 0;





function getImages(p){
  const imgs = [p.img, p.img2, p.img3, p.img4, p.img5]
    .map(x => String(x || "").trim())
    .filter(Boolean); // quita vac√≠os

  return imgs.length ? imgs : ["img/placeholder.jpg"];
}




  function renderDots(total, activeIndex){
  if(!igDots) return;

  // Si solo hay 1 imagen, no mostramos puntitos
  if(total <= 1){
    igDots.innerHTML = "";
    return;
  }

  igDots.innerHTML = "";
  for(let i = 0; i < total; i++){
    const dot = document.createElement("span");
    dot.className = "igDot" + (i === activeIndex ? " active" : "");
    igDots.appendChild(dot);
  }
}




  

function openIgModal(productId){
  const p = getProduct(productId);
  if(!p) return;

  igCurrent = p;
  igIndex = 0;

  const imgs = getImages(p);
  igImg.src = imgs[igIndex];
  renderDots(imgs.length, igIndex);
  igImg.alt = p.name;

  igName.textContent = p.name;
  igCat.textContent  = p.category || "";

  
  const d = (p.desc || "").trim();

if (d && d.toUpperCase() !== "EMPTY") {
  igDesc.style.display = "block";
  igDesc.textContent = d;
} else {
  igDesc.style.display = "none";
  igDesc.textContent = "";
}


  
  igPrice.textContent = eur(p.price);

  const stock = stockFor(p.id);
  igStock.textContent = `Stock: ${stock}`;

  // Bot√≥n a√±adir
  igAddBtn.onclick = () => {
    addToCart(p.id);
    closeIgModal(); // üëà cierra la tarjetita autom√°ticamente
  };

  // Navegaci√≥n (si hay 1 imagen, ocultar flechas)
  const canNav = imgs.length > 1;
  igPrev.style.display = canNav ? "flex" : "none";
  igNext.style.display = canNav ? "flex" : "none";

  igPrev.onclick = () => {
    igIndex = (igIndex - 1 + imgs.length) % imgs.length;
    igImg.src = imgs[igIndex];
    renderDots(imgs.length, igIndex);
  };
  igNext.onclick = () => {
    igIndex = (igIndex + 1) % imgs.length;
    igImg.src = imgs[igIndex];
    renderDots(imgs.length, igIndex);
  };

  igModal.classList.add("open");
  igModal.setAttribute("aria-hidden","false");
  document.body.style.overflow = "hidden"; // bloquea scroll atr√°s




  // ‚úÖ SWIPE en m√≥vil (tipo Instagram)
  let startX = 0;
  let startY = 0;

  const onTouchStart = (e) => {
    const t = e.touches?.[0];
    if (!t) return;
    startX = t.clientX;
    startY = t.clientY;
  };

  const onTouchEnd = (e) => {
    const t = e.changedTouches?.[0];
    if (!t) return;

    const dx = t.clientX - startX;
    const dy = t.clientY - startY;

    // Si el gesto fue m√°s vertical que horizontal, lo ignoramos (para permitir scroll)
    if (Math.abs(dy) > Math.abs(dx)) return;

    // Umbral (distancia m√≠nima para considerar swipe)
    if (Math.abs(dx) < 35) return;

    const imgs2 = getImages(igCurrent).filter(Boolean);
    if (imgs2.length <= 1) return;

    if (dx < 0) {
      // swipe izquierda => siguiente
      igIndex = (igIndex + 1) % imgs2.length;
    } else {
      // swipe derecha => anterior
      igIndex = (igIndex - 1 + imgs2.length) % imgs2.length;
    }

    igImg.src = imgs2[igIndex];
    renderDots(imgs2.length, igIndex);
  };

  // Guardamos handlers en el modal para poder quitarlos al cerrar
  igModal._touchStart = onTouchStart;
  igModal._touchEnd = onTouchEnd;

  igImg.addEventListener("touchstart", onTouchStart, { passive: true });
  igImg.addEventListener("touchend", onTouchEnd, { passive: true });

  




  
}

function closeIgModal(){
  igModal.classList.remove("open");
  igModal.setAttribute("aria-hidden","true");




  




  // ‚úÖ Quitar swipe listeners al cerrar
  if (igModal?._touchStart) igImg.removeEventListener("touchstart", igModal._touchStart);
  if (igModal?._touchEnd) igImg.removeEventListener("touchend", igModal._touchEnd);
  igModal._touchStart = null;
  igModal._touchEnd = null;



  
  document.body.style.overflow = ""; // devuelve scroll
}

// cerrar al click fuera o en X
igModal?.addEventListener("click", (e) => {
  if (e.target?.dataset?.close !== undefined) closeIgModal();
});

// cerrar con ESC
window.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && igModal.classList.contains("open")) closeIgModal();
});

// üëâ Enganche: abrir modal al tocar un producto
// En renderProducts(), despu√©s de crear cada card, a√±ade:
// el.addEventListener('click', () => openIgModal(p.id));

  


  

  // ====== RENDER ======
  function renderProducts(){
    const q = qEl.value.trim().toLowerCase();
    const list = PRODUCTS.filter(p => {
      if(!q) return true;
      return (p.name + ' ' + p.category + ' ' + (p.desc||'')).toLowerCase().includes(q);
    });

    productsEl.innerHTML = '';
    list.forEach(p => {
      const el = document.createElement('div');
      el.className = 'card';

      const inCart = qtyInCart(p.id);
      const stock = stockFor(p.id);
      const remaining = Math.max(0, stock - inCart);
      const out = stock <= 0;

      el.innerHTML = `
        <div class="pimg">
          <img src="${escapeHtml(p.img)}" alt="${escapeHtml(p.name)}" loading="lazy">
        </div>
        <div class="tag">${escapeHtml(p.category)}</div>
        <div class="title">${escapeHtml(p.name)}</div>
        <p class="desc">${escapeHtml(p.desc||'')}</p>

        <div class="stockline">
          <div class="stock">Unidades disponibles: <strong>${out ? 0 : remaining}</strong></div>
          ${out ? `<span class="badgeOut">Agotado</span>` : ``}
        </div>

        <div class="row">
          <div class="price">${eur(p.price)}</div>
          <button class="btn" data-add="${p.id}" ${out || remaining<=0 ? 'disabled' : ''}>
            ${out || remaining<=0 ? 'Sin stock' : 'A√±adir'}
          </button>
        </div>
      `;
      productsEl.appendChild(el);




el.addEventListener("click", (ev) => {
  // evita que el click del bot√≥n "A√±adir" dispare doble
  if (ev.target?.matches?.("[data-add]")) return;
  openIgModal(p.id);
});
      

      
    });

    productsEl.querySelectorAll('[data-add]').forEach(btn => {
      btn.addEventListener('click', () => addToCart(btn.getAttribute('data-add')));
    });
  }

  function renderCart(){

  if(!cartEl) return; // ‚úÖ airbag: si falta #cart, no revienta el script
    
    const items = cartItems();
    cartEl.innerHTML = '';

    if(items.length === 0){
      cartEl.innerHTML = `<p class="empty">Tu carrito est√° vac√≠o.</p>`;
      updateTotals();
      renderProducts();
      updatePayButton();
      return;
    }

    items.forEach(({id, qty, product}) => {
      const lineTotal = qty * product.price;
      const el = document.createElement('div');
      el.className = 'cartItem';
      el.innerHTML = `
        <div class="name">${escapeHtml(product.name)}</div>
        <div class="meta">
          <div class="muted">${escapeHtml(product.category)} ¬∑ ${eur(product.price)} c/u</div>
          <div class="muted"><strong>${eur(lineTotal)}</strong></div>
        </div>
        <div class="meta" style="margin-top:10px">
          <div class="qty">
            <button data-dec="${id}">‚àí</button>
            <input data-qty="${id}" inputmode="numeric" pattern="[0-9]*" value="${qty}" />
            <button data-inc="${id}" ${qty >= stockFor(id) ? 'disabled' : ''}>+</button>
          </div>
          <button class="btn danger" data-rm="${id}">Quitar</button>
        </div>
      `;
      cartEl.appendChild(el);
    });

    cartEl.querySelectorAll('[data-inc]').forEach(b => b.addEventListener('click', () => changeQty(b.getAttribute('data-inc'), +1)));
    cartEl.querySelectorAll('[data-dec]').forEach(b => b.addEventListener('click', () => changeQty(b.getAttribute('data-dec'), -1)));
    cartEl.querySelectorAll('[data-rm]').forEach(b => b.addEventListener('click', () => removeFromCart(b.getAttribute('data-rm'))));

    cartEl.querySelectorAll('[data-qty]').forEach(inp => {
      inp.addEventListener('input', () => inp.value = inp.value.replace(/[^0-9]/g, ''));
      inp.addEventListener('change', () => {
        const id = inp.getAttribute('data-qty');
        const max = stockFor(id) || 1;
        const n = clampInt(inp.value, 1, max);
        setQty(id, n);
      });
    });

    updateTotals();
    renderProducts();
  }

  function updateTotals(){
    const { distinct, units, subtotal, total } = countsAndTotals();
    cartCountEl.textContent = String(distinct);
    itemsCountEl.textContent = `${distinct} producto(s) ¬∑ ${units} unidad(es)`;
    subtotalEl.textContent = eur(subtotal);
    totalEl.textContent = eur(total);

      updatePayButton();
  }


function updatePayButton(){
  const btn = document.getElementById('payBtn');
  if(!btn) return;

  const { distinct } = countsAndTotals();
  const canPay = distinct > 0;

  btn.setAttribute('aria-disabled', canPay ? 'false' : 'true');
  btn.title = canPay ? 'Ir a pagar' : 'A√±ade productos al carrito para pagar';
  btn.tabIndex = canPay ? 0 : -1;
  btn.style.pointerEvents = canPay ? "auto" : "none";
}

  

  // ====== CARRITO ======
  function addToCart(id){
    const stock = stockFor(id);
    const current = qtyInCart(id);
    if(stock <= 0) return toast("Producto sin stock ‚ùå");
    if(current >= stock) return toast("No hay m√°s unidades üôÇ");

    cart[id] = cart[id] || { id, qty: 0 };
    cart[id].qty += 1;
    saveCart();
    renderCart();
  }

  function removeFromCart(id){
    delete cart[id];
    saveCart();
    renderCart();
  }

  function setQty(id, qty){
    const max = stockFor(id);
    const safe = Math.min(Math.max(1, qty), max);
    cart[id] = cart[id] || { id, qty: 0 };
    cart[id].qty = safe;
    saveCart();
    renderCart();
  }

  function changeQty(id, delta){
    if(!cart[id]) return;
    const max = stockFor(id);
    const next = cart[id].qty + delta;
    if(next <= 0) return removeFromCart(id);
    cart[id].qty = Math.min(next, max);
    saveCart();
    renderCart();
  }

  function clearCart(){
    cart = {};
    saveCart();
    renderCart();
  }


  // ====== UI UTILS ======
  function clampInt(v, min, max){
    const n = parseInt(String(v||'').trim(), 10);
    if(Number.isNaN(n)) return min;
    return Math.min(max, Math.max(min, n));
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'",'&#039;');
  }

  function toast(msg){
    const el = document.createElement('div');
    el.textContent = msg;
    el.style.position = 'fixed';
    el.style.left = '50%';
    el.style.bottom = '18px';
    el.style.transform = 'translateX(-50%)';
    el.style.padding = '10px 12px';
    el.style.borderRadius = '14px';
    el.style.border = '1px solid rgba(255,255,255,.14)';
    el.style.background = 'rgba(0,0,0,.55)';
    el.style.backdropFilter = 'blur(10px)';
    el.style.color = 'white';
    el.style.fontSize = '13px';
    el.style.zIndex = 9999;
    document.body.appendChild(el);
    setTimeout(() => { el.style.opacity = '0'; el.style.transition='opacity .25s'; }, 1200);
    setTimeout(() => el.remove(), 1550);
  }




  function setHeaderCatalogMode(isCatalogVisible){
  const actions = document.getElementById("headerActions");
  if(!actions) return;

  actions.classList.toggle("hidden", !isCatalogVisible);
}




// ====== CAMBIO DE VISTAS: CAT√ÅLOGO / CARRITO ======
function showCatalog(){
  document.getElementById("catalogo").style.display = "block";
  document.getElementById("cartView").style.display = "none";
  setHeaderCatalogMode(true);
}

function showCart(){
  document.getElementById("catalogo").style.display = "none";
  document.getElementById("cartView").style.display = "block";
  setHeaderCatalogMode(false);
}

  


  

// ‚úÖ HOME: mostrar secciones al hacer clic
function showHome(){
  document.getElementById("homeScreen").style.display = "grid";
  document.getElementById("servicesInfo").style.display = "none";
  document.getElementById("catalogo").style.display = "none";


  setHeaderCatalogMode(false); // üëà ocultar buscador/carrito/vaciar

  
  window.scrollTo({ top: 0, behavior: "smooth" });



  
}



  // ‚úÖ HOME CARDS
document.getElementById("servicesBlock")?.addEventListener("click", () => navigate("services"));
document.getElementById("productsBlock")?.addEventListener("click", () => navigate("catalog"));

// ‚úÖ Botones volver
document.getElementById("backHomeFromServices")?.addEventListener("click", () => navigate("home"));
document.getElementById("backHomeFromProducts")?.addEventListener("click", () => navigate("home"));







// ====== ROUTER SIMPLE (HOME / SERVICES / CATALOG / CART) ======
function getRouteFromUrl(){
  return new URLSearchParams(location.search).get("view") || "home";
}

function writeRoute(view, { replace = false } = {}){
  const url = new URL(location.href);
  url.searchParams.set("view", view);
  if (replace) history.replaceState({ view }, "", url);
  else history.pushState({ view }, "", url);
}

function setView(view){
  const home = document.getElementById("homeScreen");
  const services = document.getElementById("servicesInfo");
  const catalog = document.getElementById("catalogo");
  const cartV = document.getElementById("cartView");

  // ‚úÖ Apaga TODO siempre (para que jam√°s se mezclen)
  if (home) home.style.display = "none";
  if (services) services.style.display = "none";
  if (catalog) catalog.style.display = "none";
  if (cartV) cartV.style.display = "none";

  // ‚úÖ Enciende solo lo que toca
  if (view === "services") {
    if (services) services.style.display = "block";
    setHeaderCatalogMode(false);
  } else if (view === "catalog") {
    if (catalog) catalog.style.display = "block";
    setHeaderCatalogMode(true);
  } else if (view === "cart") {
    if (cartV) cartV.style.display = "block";
    setHeaderCatalogMode(false);
  } else {
    // home
    if (home) home.style.display = "grid";
    setHeaderCatalogMode(false);
  }

  // opcional: subir arriba siempre al cambiar de vista
  window.scrollTo({ top: 0, behavior: "smooth" });



  setActiveTab(view); // üëà a√±ade esto


  
}

function navigate(view, { replace = false } = {}){
  setView(view);
  writeRoute(view, { replace });
}







 function setActiveTab(view){
  document.querySelectorAll(".tab").forEach(b => {
    b.classList.toggle("active", b.dataset.view === view);
  });
}







  

// ‚úÖ ATR√ÅS / ADELANTE del navegador
window.addEventListener("popstate", (e) => {
  const view = e.state?.view || getRouteFromUrl();
  setView(view);
});







  



  
 // ====== INIT ======
window.addEventListener("DOMContentLoaded", async () => {
  
  qEl.addEventListener("input", renderProducts);


const topBar = document.querySelector(".top");

// cuando el buscador recibe foco
qEl.addEventListener("focus", () => {
  if (window.innerWidth <= 600) {
    topBar.classList.add("search-active");
  }
});

// cuando pierde foco
qEl.addEventListener("blur", () => {
  topBar.classList.remove("search-active");
});


  
  document.getElementById("resetBtn")?.addEventListener("click", clearCart);


document.getElementById("cartCount")?.addEventListener("click", () => {
  const header = document.getElementById("headerActions");
  if (header?.classList.contains("hidden")) return; // üõë seguridad
  navigate("cart");
});
document.getElementById("backToCatalog")?.addEventListener("click", () => navigate("catalog"));


  

  await loadProductsFromSupabase();
  reconcileCartWithStock(false);
  renderCart();
  subscribeRealtimeProducts();
  updatePayButton();

  // üîê AUTO LOGOUT SI NO EST√ÅS EN ?admin=1
  await autoLogoutIfNotAdminPage();

  // Admin (solo si entras con ?admin=1)
  await showAdminPanel();

  if (wantsAdminUI()) {
    window.addEventListener("pagehide", async () => {
      await sb.auth.signOut();
    });
  }

  document.getElementById("adminLoginBtn")?.addEventListener("click", adminLogin);
  document.getElementById("adminLogoutBtn")?.addEventListener("click", adminLogout);
  document.getElementById("adminUploadBtn")?.addEventListener("click", adminUploadAndAssign);

  document.getElementById("adminRefreshBtn")?.addEventListener("click", async () => {
    await loadProductsFromSupabase();
    fillAdminProducts();
    toast("Productos recargados ‚úÖ");
  });


// ‚úÖ al iniciar, pinta lo que diga la URL
const initial = getRouteFromUrl();
writeRoute(initial, { replace: true }); // fija state para que popstate tenga view
setView(initial);


  
  // ‚úÖ CLICK: Confirmar pedido (ya no pago)
  document.getElementById("payBtn")?.addEventListener("click", async (e) => {
  e.preventDefault();

  const btn = e.currentTarget;
  if (btn.getAttribute("aria-disabled") === "true") {
    toast("A√±ade productos antes de confirmar üôÇ");
    return;
  }

  const name = (document.getElementById("customerName")?.value || "").trim();
  const phone = (document.getElementById("customerPhone")?.value || "").trim();
  if (!name || !phone) return toast("Falta nombre o tel√©fono");

  const check = await validateCartBeforePay();
  if (!check.ok) return toast("Se actualiz√≥ el stock y tu carrito qued√≥ vac√≠o üôÇ");

  const items = cartItems().map(x => ({
    product_id: x.id,
    qty: x.qty,
  }));

  try {
    btn.setAttribute("aria-disabled", "true");
    btn.style.pointerEvents = "none";

    const resp = await fetch("/api/place-order", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        customer: { name, phone },
        items,
      }),
    });

    const raw = await resp.text();
let data = {};
try { data = raw ? JSON.parse(raw) : {}; } catch { data = { raw }; }

    if (!resp.ok || !data?.ok) {
      console.error("PLACE ORDER ERROR:", data?.error, data?.details, data);
      toast("No se pudo confirmar: " + (data?.error || data?.details || data?.raw || "Error"));
      btn.setAttribute("aria-disabled", "false");
      btn.style.pointerEvents = "auto";
      return;
    }

    // Guarda para el comprobante (opcional)
    localStorage.setItem("last_order", JSON.stringify({
      id: data.order.id,
      ticket: data.order.ticket_number,
      name, phone,
      items,
      total: data.order.total
    }));

    // limpia carrito
    cart = {};
    saveCart();
    renderCart();

    // ir a comprobante
    location.href = `./pago-ok.html?order=${encodeURIComponent(data.order.id)}`;

  } catch (err) {
    console.error(err);
    toast("No se pudo confirmar: Error de red");
    btn.setAttribute("aria-disabled", "false");
    btn.style.pointerEvents = "auto";
  }
});



    /*forza a usar solo numeros*/

const phoneInput = document.getElementById("customerPhone");

if (phoneInput) {
  phoneInput.addEventListener("input", () => {
    phoneInput.value = phoneInput.value.replace(/\D+/g, "");
  });
}



document.querySelectorAll(".tab").forEach(btn => {
  btn.addEventListener("click", async () => {
    const v = btn.dataset.view;

    navigate(v);
    setActiveTab(v);
  });
});


  

});

  
</script>


  

</body>
</html>
